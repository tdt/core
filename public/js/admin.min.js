function buildURI(a){var b=$("#input_identifier_display").data("url"),c=$("#input_collection").val()+"/"+$("#input_resource_name").val();$("#input_identifier_display").html(b+c),$("#input_identifier").val(c)}!function(a,b){"object"==typeof exports?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a)}(this,function(a){function b(a){this._targetElement=a,this._options={nextLabel:"Next &rarr;",prevLabel:"&larr; Back",skipLabel:"Skip",doneLabel:"Done",tooltipPosition:"bottom",tooltipClass:"",exitOnEsc:!0,exitOnOverlayClick:!0,showStepNumbers:!0,keyboardNavigation:!0,showButtons:!0,showBullets:!0}}function c(a){var b=[],c=this;if(this._options.steps)for(var d=[],h=0,j=this._options.steps.length;j>h;h++){var k=this._options.steps[h];k.step=h+1,"string"==typeof k.element&&(k.element=document.querySelector(k.element)),b.push(k)}else{var d=a.querySelectorAll("*[data-intro]");if(d.length<1)return!1;for(var h=0,l=d.length;l>h;h++){var m=d[h],o=parseInt(m.getAttribute("data-step"),10);o>0&&(b[o-1]={element:m,intro:m.getAttribute("data-intro"),step:parseInt(m.getAttribute("data-step"),10),tooltipClass:m.getAttribute("data-tooltipClass"),position:m.getAttribute("data-position")||this._options.tooltipPosition})}for(var p=0,h=0,l=d.length;l>h;h++){var m=d[h];if(null==m.getAttribute("data-step")){for(;;){if("undefined"==typeof b[p])break;p++}b[p]={element:m,intro:m.getAttribute("data-intro"),step:p+1,tooltipClass:m.getAttribute("data-tooltipClass"),position:m.getAttribute("data-position")||this._options.tooltipPosition}}}}for(var q=[],r=0;r<b.length;r++)b[r]&&q.push(b[r]);if(b=q,b.sort(function(a,b){return a.step-b.step}),c._introItems=b,n.call(c,a)){e.call(c);a.querySelector(".introjs-skipbutton"),a.querySelector(".introjs-nextbutton");c._onKeyDown=function(b){27===b.keyCode&&1==c._options.exitOnEsc?(g.call(c,a),void 0!=c._introExitCallback&&c._introExitCallback.call(c)):37===b.keyCode?f.call(c):(39===b.keyCode||13===b.keyCode)&&(e.call(c),b.preventDefault?b.preventDefault():b.returnValue=!1)},c._onResize=function(a){i.call(c,document.querySelector(".introjs-helperLayer"))},window.addEventListener?(this._options.keyboardNavigation&&window.addEventListener("keydown",c._onKeyDown,!0),window.addEventListener("resize",c._onResize,!0)):document.attachEvent&&(this._options.keyboardNavigation&&document.attachEvent("onkeydown",c._onKeyDown),document.attachEvent("onresize",c._onResize))}return!1}function d(a){this._currentStep=a-2,"undefined"!=typeof this._introItems&&e.call(this)}function e(){if("undefined"==typeof this._currentStep?this._currentStep=0:++this._currentStep,this._introItems.length<=this._currentStep)return"function"==typeof this._introCompleteCallback&&this._introCompleteCallback.call(this),void g.call(this,this._targetElement);var a=this._introItems[this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,a.element),j.call(this,a)}function f(){if(0===this._currentStep)return!1;var a=this._introItems[--this._currentStep];"undefined"!=typeof this._introBeforeChangeCallback&&this._introBeforeChangeCallback.call(this,a.element),j.call(this,a)}function g(a){var b=a.querySelector(".introjs-overlay");b.style.opacity=0,setTimeout(function(){b.parentNode&&b.parentNode.removeChild(b)},500);var c=a.querySelector(".introjs-helperLayer");c&&c.parentNode.removeChild(c);var d=document.querySelector(".introjs-showElement");d&&(d.className=d.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""));var e=document.querySelectorAll(".introjs-fixParent");if(e&&e.length>0)for(var f=e.length-1;f>=0;f--)e[f].className=e[f].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown),this._currentStep=void 0}function h(a,b,c){if(b.style.top=null,b.style.right=null,b.style.bottom=null,b.style.left=null,this._introItems[this._currentStep]){var d="",e=this._introItems[this._currentStep];d="string"==typeof e.tooltipClass?e.tooltipClass:this._options.tooltipClass,b.className=("introjs-tooltip "+d).replace(/^\s+|\s+$/g,"");var d=this._options.tooltipClass,f=this._introItems[this._currentStep].position;switch(f){case"top":b.style.left="15px",b.style.top="-"+(o(b).height+10)+"px",c.className="introjs-arrow bottom";break;case"right":b.style.left=o(a).width+20+"px",c.className="introjs-arrow left";break;case"left":b.style.top="15px",b.style.right=o(a).width+20+"px",c.className="introjs-arrow right";break;case"bottom":default:b.style.bottom="-"+(o(b).height+10)+"px",c.className="introjs-arrow top"}}}function i(a){if(a){if(!this._introItems[this._currentStep])return;var b=o(this._introItems[this._currentStep].element);a.setAttribute("style","width: "+(b.width+10)+"px; height:"+(b.height+10)+"px; top:"+(b.top-5)+"px;left: "+(b.left-5)+"px;")}}function j(a){"undefined"!=typeof this._introChangeCallback&&this._introChangeCallback.call(this,a.element);var b=this,c=document.querySelector(".introjs-helperLayer");o(a.element);if(null!=c){var d=c.querySelector(".introjs-helperNumberLayer"),j=c.querySelector(".introjs-tooltiptext"),n=c.querySelector(".introjs-arrow"),p=c.querySelector(".introjs-tooltip"),q=c.querySelector(".introjs-skipbutton"),r=c.querySelector(".introjs-prevbutton"),s=c.querySelector(".introjs-nextbutton");p.style.opacity=0,i.call(b,c);var t=document.querySelectorAll(".introjs-fixParent");if(t&&t.length>0)for(var u=t.length-1;u>=0;u--)t[u].className=t[u].className.replace(/introjs-fixParent/g,"").replace(/^\s+|\s+$/g,"");var v=document.querySelector(".introjs-showElement");v.className=v.className.replace(/introjs-[a-zA-Z]+/g,"").replace(/^\s+|\s+$/g,""),b._lastShowElementTimer&&clearTimeout(b._lastShowElementTimer),b._lastShowElementTimer=setTimeout(function(){null!=d&&(d.innerHTML=a.step),j.innerHTML=a.intro,h.call(b,a.element,p,n),c.querySelector(".introjs-bullets li > a.active").className="",c.querySelector('.introjs-bullets li > a[data-stepnumber="'+a.step+'"]').className="active",p.style.opacity=1},350)}else{var w=document.createElement("div"),x=document.createElement("div"),y=document.createElement("div"),z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div");w.className="introjs-helperLayer",i.call(b,w),this._targetElement.appendChild(w),x.className="introjs-arrow",z.className="introjs-tooltiptext",z.innerHTML=a.intro,A.className="introjs-bullets",this._options.showBullets===!1&&(A.style.display="none");for(var C=document.createElement("ul"),u=0,D=this._introItems.length;D>u;u++){var E=document.createElement("li"),F=document.createElement("a");F.onclick=function(){b.goToStep(this.getAttribute("data-stepnumber"))},0===u&&(F.className="active"),F.href="javascript:void(0);",F.innerHTML="&nbsp;",F.setAttribute("data-stepnumber",this._introItems[u].step),E.appendChild(F),C.appendChild(E)}if(A.appendChild(C),B.className="introjs-tooltipbuttons",this._options.showButtons===!1&&(B.style.display="none"),y.className="introjs-tooltip",y.appendChild(z),y.appendChild(A),1==this._options.showStepNumbers){var G=document.createElement("span");G.className="introjs-helperNumberLayer",G.innerHTML=a.step,w.appendChild(G)}y.appendChild(x),w.appendChild(y);var s=document.createElement("a");s.onclick=function(){b._introItems.length-1!=b._currentStep&&e.call(b)},s.href="javascript:void(0);",s.innerHTML=this._options.nextLabel;var r=document.createElement("a");r.onclick=function(){0!=b._currentStep&&f.call(b)},r.href="javascript:void(0);",r.innerHTML=this._options.prevLabel;var q=document.createElement("a");q.className="introjs-button introjs-skipbutton",q.href="javascript:void(0);",q.innerHTML=this._options.skipLabel,q.onclick=function(){b._introItems.length-1==b._currentStep&&"function"==typeof b._introCompleteCallback&&b._introCompleteCallback.call(b),b._introItems.length-1!=b._currentStep&&"function"==typeof b._introExitCallback&&b._introExitCallback.call(b),g.call(b,b._targetElement)},B.appendChild(q),this._introItems.length>1&&(B.appendChild(r),B.appendChild(s)),y.appendChild(B),h.call(b,a.element,y,x)}0==this._currentStep?(r.className="introjs-button introjs-prevbutton introjs-disabled",s.className="introjs-button introjs-nextbutton",q.innerHTML=this._options.skipLabel):this._introItems.length-1==this._currentStep?(q.innerHTML=this._options.doneLabel,r.className="introjs-button introjs-prevbutton",s.className="introjs-button introjs-nextbutton introjs-disabled"):(r.className="introjs-button introjs-prevbutton",s.className="introjs-button introjs-nextbutton",q.innerHTML=this._options.skipLabel),s.focus(),a.element.className+=" introjs-showElement";var H=k(a.element,"position");"absolute"!==H&&"relative"!==H&&(a.element.className+=" introjs-relativePosition");for(var I=a.element.parentNode;null!=I&&"body"!==I.tagName.toLowerCase();){var J=k(I,"z-index");/[0-9]+/.test(J)&&(I.className+=" introjs-fixParent"),I=I.parentNode}if(!m(a.element)){var K=a.element.getBoundingClientRect(),L=l().height,M=K.bottom-(K.bottom-K.top),N=K.bottom-L;0>M||a.element.clientHeight>L?window.scrollBy(0,M-30):window.scrollBy(0,N+100)}}function k(a,b){var c="";return a.currentStyle?c=a.currentStyle[b]:document.defaultView&&document.defaultView.getComputedStyle&&(c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b)),c&&c.toLowerCase?c.toLowerCase():c}function l(){if(void 0!=window.innerWidth)return{width:window.innerWidth,height:window.innerHeight};var a=document.documentElement;return{width:a.clientWidth,height:a.clientHeight}}function m(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom+80<=window.innerHeight&&b.right<=window.innerWidth}function n(a){var b=document.createElement("div"),c="",d=this;if(b.className="introjs-overlay","body"===a.tagName.toLowerCase())c+="top: 0;bottom: 0; left: 0;right: 0;position: fixed;",b.setAttribute("style",c);else{var e=o(a);e&&(c+="width: "+e.width+"px; height:"+e.height+"px; top:"+e.top+"px;left: "+e.left+"px;",b.setAttribute("style",c))}return a.appendChild(b),b.onclick=function(){1==d._options.exitOnOverlayClick&&(g.call(d,a),void 0!=d._introExitCallback&&d._introExitCallback.call(d))},setTimeout(function(){c+="opacity: .8;",b.setAttribute("style",c)},10),!0}function o(a){var b={};b.width=a.offsetWidth,b.height=a.offsetHeight;for(var c=0,d=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return b.top=d,b.left=c,b}function p(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}var q="0.6.0",r=function(a){if("object"==typeof a)return new b(a);if("string"==typeof a){var c=document.querySelector(a);if(c)return new b(c);throw new Error("There is no element with given selector.")}return new b(document.body)};return r.version=q,r.fn=b.prototype={clone:function(){return new b(this)},setOption:function(a,b){return this._options[a]=b,this},setOptions:function(a){return this._options=p(this._options,a),this},start:function(){return c.call(this,this._targetElement),this},goToStep:function(a){return d.call(this,a),this},exit:function(){g.call(this,this._targetElement)},refresh:function(){return i.call(this,document.querySelector(".introjs-helperLayer")),this},onbeforechange:function(a){if("function"!=typeof a)throw new Error("Provided callback for onbeforechange was not a function");return this._introBeforeChangeCallback=a,this},onchange:function(a){if("function"!=typeof a)throw new Error("Provided callback for onchange was not a function.");return this._introChangeCallback=a,this},oncomplete:function(a){if("function"!=typeof a)throw new Error("Provided callback for oncomplete was not a function.");return this._introCompleteCallback=a,this},onexit:function(a){if("function"!=typeof a)throw new Error("Provided callback for onexit was not a function.");return this._introExitCallback=a,this}},a.introJs=r,r}),$(".delete").on("click",function(){return window.confirm("Are you sure you want to delete this?")}),$(".btn.edit-user").on("click",function(a){a.preventDefault();var b=$(this).parents(".dataset"),c=b.data("id"),d=b.data("name"),e=b.data("group"),f=$("#editUser");$("#inputEditId").val(c),$("#inputEditName").prop("disabled",!1).val(d),$("#inputEditGroup").prop("disabled",!1),$('#inputEditGroup option[value="'+e+'"]').prop("selected",!0),3>c&&($("#inputEditName").prop("disabled",!0),$("#inputEditGroup").prop("disabled",!0),2>c&&$("#inputEditPassword").prop("disabled",!0)),f.modal("show")}),$(".btn.edit-group").on("click",function(a){a.preventDefault();var b=$(this).parents(".dataset"),c=b.data("id"),d=b.data("name"),e=$("#editGroup");$("#inputEditId").val(c),$("#inputEditName").val(d),e.modal("show")}),$(".permissions").hide(),$(".edit-permissions").on("click",function(a){$(this).next(".permissions").toggle()}),$(".hover-help").tooltip(),$(".hover-help").on("click",function(a){a.preventDefault()}),$("form.add-dataset .identifier #input_collection, form.add-dataset .identifier #input_resource_name").on({keydown:buildURI,keyup:buildURI}),$(".btn-attribution").on("click",function(a){var b=$(a.target).parent().parent().parent(),c=JSON.parse($(a.target).next().val()),d=$("#person").html().replace("#ROLE#",c.name).replace("#DESC#",c.desc).replace("#OPTION#",c.option);b.append(d)}),$(".attribution-person .btn-delete").on("click",function(a){$(this).closest(".attribution-person").remove()}),$("input[name=publisher_uri], input[name=publisher_uri]").on("blur",function(a){var b=$(this).val();b&&"http:/"!==b.slice(0,6)&&"https:"!==b.slice(0,6)&&$(this).val("http://"+b)}),$(".btn-add-dataset").on("click",function(a){a.preventDefault();var b=$("form.add-dataset"),c=$(".tab-pane.active"),d=(c.data("mediatype"),{}),e=$("#input_identifier",b).val();$("input, textarea, select",c).each(function(){$(this).attr("name")&&("checkbox"==$(this).attr("type")?d[$(this).attr("name")]=$(this).prop("checked")?1:0:"profile"==d[$(this).attr("name")]?$(this).prop("checked")&&(d[$(this).attr("name")]=$(this).val()):d[$(this).attr("name")]=$(this).val())}),$(".attribution-person",c).each(function(){d.attribution||(d.attribution=[]);var a=$(this).find(".name").val(),b=$(this).find(".email").val();(a||b)&&d.attribution.push({role:$(this).data("role"),name:a,email:b})}),$.ajax({url:baseURL+"api/definitions/"+e,data:JSON.stringify(d),method:"PUT",headers:{Accept:"application/json","Content-Type":"application/tdt.definition+json",Authorization:authHeader},success:function(a){window.location=baseURL+"api/admin/datasets"},error:function(a){if(405!=a.status){var b=JSON.parse(a.responseText);b.error&&b.error.message&&($(".error .text",c).html(b.error.message),$(".error",c).removeClass("hide").show().focus())}else window.location=baseURL+"api/admin/datasets"}})}),$(".btn-edit-dataset").on("click",function(a){a.preventDefault();var b=$("form.edit-dataset"),c=(b.data("mediatype"),b.data("identifier")),d={};$("input, textarea, select",b).each(function(){$(this).attr("name")&&("checkbox"==$(this).attr("type")?d[$(this).attr("name")]=$(this).prop("checked")?1:0:"profile"==$(this).attr("name")?$(this).prop("checked")&&(d[$(this).attr("name")]=$(this).val()):d[$(this).attr("name")]=$(this).val())}),$(".attribution-person").each(function(){d.attribution||(d.attribution=[]);var a=$(this).find(".name").val(),b=$(this).find(".email").val();(a||b)&&d.attribution.push({role:$(this).data("role"),name:a,email:b})}),$.ajax({url:baseURL+"api/definitions/"+c,data:JSON.stringify(d),method:"POST",headers:{Accept:"application/json",Authorization:authHeader},success:function(a){window.location=baseURL+"api/admin/datasets"},error:function(a){if(405!=a.status){var b=JSON.parse(a.responseText);b.error&&b.error.message&&($(".error .text").html(b.error.message),$(".error").removeClass("hide").show().focus())}else window.location=baseURL+"api/admin/datasets"}})});var mapScriptLoaded=!1;$(".location-picker").one("click",function(a){$(this).height("300px").removeClass("btn").removeClass("btn-default");var b,c,d,e=$(a.target).closest(".panel"),f=$("#"+$(this).data("id"),e),g=function(){d=new google.maps.Map($(".location-picker",e).get(0),{mapTypeControl:!1,streetViewControl:!1,center:{lat:50,lng:10},zoom:2});var a;try{var g=JSON.parse(JSON.parse(f.val()));a={north:g.coordinates[0][0][1],south:g.coordinates[0][2][1],east:g.coordinates[0][2][0],west:g.coordinates[0][0][0]}}catch(i){a={north:70,south:35,east:40,west:-10}}c=new google.maps.InfoWindow,b=new google.maps.Rectangle({bounds:a,draggable:!0,editable:!0}),b.addListener("bounds_changed",h),h(),b.setMap(d)},h=function(a){var e=b.getBounds().getNorthEast(),g=b.getBounds().getSouthWest(),h="North-east corner: "+e.lat()+", "+e.lng()+"<br>South-west corner: "+g.lat()+", "+g.lng();f.val(JSON.stringify({type:"Polygon",coordinates:[[[g.lng(),e.lat()],[e.lng(),e.lat()],[e.lng(),g.lat()],[g.lng(),g.lat()],[g.lng(),e.lat()]]]})),c.setContent(h),c.setPosition(e),c.open(d)};if(mapScriptLoaded)g();else{var i=document.createElement("script");i.onload=g,i.setAttribute("type","text/javascript"),i.setAttribute("src","https://maps.googleapis.com/maps/api/js"),document.head.appendChild(i),mapScriptLoaded=!0}});var selectProfile=function(a,b){"dcat"==a?($(".profile-geodcat",b).hide(),$(".profile-dcat",b).show(),b.removeClass("geodcat-enabled")):($(".profile-dcat",b).hide(),$(".profile-geodcat",b).show(),b.addClass("geodcat-enabled"),$(".location-picker",b).click())};selectProfile($(".profile-selector input[name=profile]:checked").val(),$(".panel-dcat")),$(".profile-selector").on("change",function(a){var b=$(a.target).closest(".panel");selectProfile($(a.target).val(),b)}),$(".introjs").on("click",function(a){a.preventDefault(),introJs().start()});